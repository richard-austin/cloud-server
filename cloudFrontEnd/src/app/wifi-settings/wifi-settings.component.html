<div class="wifi-settings-container">
  <mat-card>
    <mat-card-title>Wifi Settings</mat-card-title>
    <mat-card-content>
      @if (ethernetConnectionStatus == 'NOT_CONNECTED_VIA_ETHERNET') {
        <div class="alert-warning-embedded">
          You have an Ethernet connection, but your NVR is connected to the Cloud service through Wi-Fi.
          To make changes to the Wi-Fi settings, this connection must be through Ethernet. To switch the connection to
          Ethernet,
          click the Reset Connection button, then wait until display shows the current Wi-Fi status again.
        </div>
      }

      @if (ethernetConnectionStatus == 'NO_ETHERNET') {
        <div class="alert-warning-embedded">
          You have no Ethernet connection available,
          To make changes to the Wi-Fi settings, the NVR must be connected to the Cloud Service through Ethernet.
          To switch the connection to Ethernet, connect an Ethernet cable between your router and the NVR then
          click the Reset Connection button, then wait until display shows the current Wi-Fi status again.
        </div>
      }
      @if ((ethernetConnectionStatus != 'CONNECTED_VIA_ETHERNET' && ethernetConnectionStatus != '') || resetting) {
        <div class="reset-connection-button loading-spinner">
          @if (ethernetConnectionStatus != 'CONNECTED_VIA_ETHERNET' && ethernetConnectionStatus != '') {
            <button
              [disabled]="resetting"
              color="warn" mat-raised-button
              (click)="resetConnection()">Reset Connection
            </button>
          }
          @if (resetting) {
            <mat-spinner [diameter]="25"></mat-spinner>
            Restarting Cloud Proxy
          }
        </div>
      }
      <app-reporting [embedded]="true"></app-reporting>
      <mat-checkbox [color]="'primary'" [checked]="wifiEnabled"
        #wifiStatusCheckbox
        matTooltip="Wi-Fi is currently {{wifiEnabled ? 'enabled' : 'disabled'}}, click to {{wifiEnabled ? 'disable' : 'enable'}}"
        matTooltipClass="tooltip"
        [disabled]="ethernetConnectionStatus != 'CONNECTED_VIA_ETHERNET'"
        (change)="setWifiStatus($event)">
        {{wifiEnabled ? 'Disable' : 'Enable'}} Wi-Fi
      </mat-checkbox>
      <div>
        <mat-form-field appearance="outline" [style.width.px]="315">
          @if (!loading) {
            <mat-label>
              {{wifiEnabled ? 'Select Wi-Fi Access Point' : 'Wi-Fi Is Off'}}
            </mat-label>
          }
          @if (loading) {
            <mat-label>
              <div class="loading-spinner">
                <mat-spinner [diameter]="20"></mat-spinner>
                Loading..
              </div>
            </mat-label>
          }
          <mat-select [disabled]="ethernetConnectionStatus != 'CONNECTED_VIA_ETHERNET' || !wifiEnabled"
            (selectionChange)="onSelectorChange()"
            #selector>
            @for (wifi of wifiList; track wifi) {
              <mat-option [value]="wifi.ssid">
                {{wifi.ssid}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      @if (needPassword) {
        <div>
          <mat-form-field class="password-field" appearance="outline" [style.width.px]="315">
            <input matInput type="password" [formControl]="getFormControl(enterPasswordForm, 'password')"
              matTooltip="Enter password for {{selector.value}}"
              matTooltipClass="tooltip"
              placeholder="Password for {{selector.value}}">
            <mat-label>New password for {{selector.value}}</mat-label>
            @if (hasError('password', 'minlength') && !hasError('password', 'required')) {
              <mat-error>Password must be at least 8 characters in length</mat-error>
            }
            @if (hasError('password', 'required')) {
              <mat-error>Password is required</mat-error>
            }
          </mat-form-field>
        </div>
      }
      <div class="connect-cancel">
        <button [disabled]="!wifiEnabled || currentWifiConnection.accessPoint == selector.value || connecting || anyInvalid()"
          mat-raised-button
          color="warn"
          (click)="connect()">Connect
        </button>
        @if (needPassword) {
          <button mat-raised-button color="cancel" (click)="cancelPasswordEntry()">Cancel</button>
        }
        @if (connecting) {
          <span class="connecting-spinner">
            <mat-spinner [diameter]="25"></mat-spinner>
            Connecting to {{selector.value}}
          </span>
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>
